function getQueryVariable(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}return!1}$(function(){$(".popup-close").click(function(){var a="#"+$(this).data("target");$(a).length&&($(".cover").hide(),$(a).hide())}),$(".popup-button").click(function(){var a="#"+$(this).data("target");$(a).length&&($(".cover").show(),$(a).show())}),$(".cover").hide(),$(".popup").hide(),copytimeron=!1,failuretimeron=!1,$(".copy-button").click(function(){var a="#"+$(this).data("target");if($(a).length){$(a).select();try{copied=document.execCommand("copy")}catch(a){copied=!1}if(copied){copytimeron&&clearTimeout(copytimeout);var b="."+$(this).data("success"),c=$(this).parent().find(b);c.show(),copytimeron=!0,copytimeout=setTimeout(function(){c.hide(),copytimeron=!1},2e3)}else{failuretimeron&&clearTimeout(failuretimeout);var b="."+$(this).data("failure"),c=$(this).parent().find(b);c.show(),failuretimeron=!0,failuretimeout=setTimeout(function(){c.hide(),failuretimeron=!1},3e3)}}})}),globalGameConfig={width:760,height:480,backgroundColor:"#eeeeee",grid:{h:20,v:15}};var MazeGame=function(a){this.table=$(a),this.onChange=null,this.grid=new Array,this.generator=!1,this.hasPath=!1,this.moves=0,this.minmoves=0,this.gridsize={h:globalGameConfig.grid.h,v:globalGameConfig.grid.v},this.colors={wall:"#111111"},this.player=$('<span class="ball player"></span>'),this.door=$('<span class="ball green door"></span>'),this.startingPosition={i:1,j:1},this.endingPosition={i:29,j:39},this.ball={object:this.player,j:this.startingPosition.j,i:this.startingPosition.i}};MazeGame.prototype.start=function(){this.generator?this.table.addClass("maze-creating"):this.table.addClass("maze-playing"),this.generateMaze()},MazeGame.prototype.generateMaze=function(){for(var a=0;a<this.gridsize.v;a++)this.grid[2*a]=new Array,this.grid[2*a+1]=new Array,this.generateWallRow(2*a),this.generateRow(2*a+1);this.grid[2*a]=new Array,this.generateWallRow(2*a)},MazeGame.prototype.generateWallRow=function(a){var b=$("<tr></tr>");this.table.append(b);for(var c=0;c<this.gridsize.h;c++)this.generateJointCell(b,a,2*c),this.generateWallCellHorizontal(b,a,2*c+1);this.generateJointCell(b,a,2*c)},MazeGame.prototype.generateRow=function(a){var b=$("<tr></tr>");this.table.append(b);for(var c=0;c<this.gridsize.h;c++)this.generateWallCellVertical(b,a,2*c),this.generateCell(b,a,2*c+1);this.generateWallCellVertical(b,a,2*c)},MazeGame.prototype.generateCell=function(a,b,c){var d=$("<td></td>");return d.data("i",b),d.data("j",c),this.grid[b][c]=d,a.append(d),this.startingPosition.i==b&&this.startingPosition.j==c&&d.append(this.player),this.endingPosition.i==b&&this.endingPosition.j==c&&d.append(this.door),d},MazeGame.prototype.generateJointCell=function(a,b,c){this.generateCell(a,b,c).addClass("joint")},MazeGame.prototype.generateWallCell=function(a,b,c){var d=this.generateCell(a,b,c);if(d.addClass("wall"),this.generator){var e=this;d.click(function(){e.wallClicked($(this),e)})}return d},MazeGame.prototype.generateWallCellHorizontal=function(a,b,c){this.generateWallCell(a,b,c).addClass("horizontal")},MazeGame.prototype.generateWallCellVertical=function(a,b,c){this.generateWallCell(a,b,c).addClass("vertical")},MazeGame.prototype.wallClicked=function(a,b){a.toggleClass("inactive");b.pathFind(b.startingPosition,b.endingPosition);null!==this.onChange&&this.onChange(this)},MazeGame.prototype.loadInactiveCells=function(){grid=this.grid;for(var a=new Array,b=new Array,c=0;c<grid.length;c++)for(var d=0;d<grid[c].length;d++)grid[c][d].hasClass("wall")&&(grid[c][d].hasClass("inactive")?a.push({i:c,j:d}):b.push({i:c,j:d}));return{inactive:a,active:b}},MazeGame.prototype.renderInactiveCells=function(){var a=this.loadInactiveCells(),b=JSON.stringify(a.inactive);$(".debugdata").html(b)},MazeGame.prototype.compressedCellData=function(){var a=this.loadInactiveCells(),b="";a.inactive.length>a.active.length?(x=a.active,b="o"):(x=a.inactive,b="i");for(var c=0;c<x.length;c++)b+=this.nodeToString(x[c]);return b},MazeGame.prototype.generateURL=function(){var a=this.compressedCellData(),b=this.gridsize.h<10?"0"+this.gridsize.h:""+this.gridsize.h,c=this.gridsize.v<10?"0"+this.gridsize.v:""+this.gridsize.v,d=this.nodeToString(this.startingPosition),e=this.nodeToString(this.endingPosition),f=b+c+d+e+a,g=document.location.href,h=document.createElement("a");h.href=g;var i=h.host.toString();if("/"!=i.substring(i.length-1,i.length)&&"/"!=h.pathname.substring(0,1))var j=h.protocol+"//"+i+"/"+h.pathname+"?d="+f;else var j=h.protocol+"//"+i+h.pathname+"?d="+f;return j=j.replace("make","play")},MazeGame.prototype.disableAllButWalls=function(a){for(var b=this.grid,c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++)if(b[c][d].hasClass("wall")){var e=this.nodeToString({i:c,j:d});a.indexOf(e)>=0?b[c][d].removeClass("inactive"):b[c][d].addClass("inactive")}},MazeGame.prototype.enableAllButWalls=function(a){for(var b=this.grid,c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++)if(b[c][d].hasClass("wall")){var e=c<10?"0"+c:""+c,f=d<10?"0"+d:""+d;a.indexOf(e+f)>=0?b[c][d].addClass("inactive"):b[c][d].removeClass("inactive")}},MazeGame.prototype.enableAllWalls=function(){for(var a=this.grid,b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)a[b][c].hasClass("wall")&&a[b][c].hasClass("inactive")&&a[b][c].removeClass("inactive")},MazeGame.prototype.disableAllWalls=function(){for(var a=this.grid,b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)a[b][c].hasClass("wall")&&(a[b][c].hasClass("inactive")||a[b][c].addClass("inactive"))},MazeGame.prototype.loadGridInfoFromURL=function(){var a=getQueryVariable("d");a&&(this.gridsize.h=parseInt(a.substring(0,2)),this.gridsize.v=parseInt(a.substring(2,4)),this.startingPosition.i=parseInt(a.substring(4,6)),this.startingPosition.j=parseInt(a.substring(6,8)),this.endingPosition.i=parseInt(a.substring(8,10)),this.endingPosition.j=parseInt(a.substring(10,12)))},MazeGame.prototype.loadFromURL=function(){var a=getQueryVariable("d");if(a){var b=a.substring(12);if(b){var c=b.substring(0,1),d=b.substring(1),e=new Array,f=d.match(/.{1,4}/g);if(null!==f)for(var g=0;g<f.length;g++){var h=f[g],i=h.match(/.{1,2}/g);2==i.length&&e.push(h)}"i"==c?this.enableAllButWalls(e):this.disableAllButWalls(e)}}},MazeGame.prototype.loadGridInfoFromString=function(a){a&&(this.gridsize.h=parseInt(a.substring(0,2)),this.gridsize.v=parseInt(a.substring(2,4)),this.startingPosition.i=parseInt(a.substring(4,6)),this.startingPosition.j=parseInt(a.substring(6,8)),this.endingPosition.i=parseInt(a.substring(8,10)),this.endingPosition.j=parseInt(a.substring(10,12)))},MazeGame.prototype.loadFromString=function(a){if(a){var b=a.substring(12);if(b){var c=b.substring(0,1),d=b.substring(1),e=new Array,f=d.match(/.{1,4}/g);if(null!==f)for(var g=0;g<f.length;g++){var h=f[g],i=h.match(/.{1,2}/g);2==i.length&&e.push(h)}"i"==c?this.enableAllButWalls(e):this.disableAllButWalls(e)}}},MazeGame.prototype.startInput=function(){var a=this;$(document).on("keypress",function(b){37==b.keyCode&&a.moveBallLeft(),38==b.keyCode&&a.moveBallUp(),39==b.keyCode&&a.moveBallRight(),40==b.keyCode&&a.moveBallDown()})},MazeGame.prototype.moveBallUp=function(){var a=this.ball.i-2,b=this.ball.j,c=this.ball.i-1,d=this.ball.j;this.grid[c][d].hasClass("inactive")&&this.moveBall(a,b)},MazeGame.prototype.moveBallLeft=function(){var a=this.ball.i,b=this.ball.j-2,c=this.ball.i,d=this.ball.j-1;this.grid[c][d].hasClass("inactive")&&this.moveBall(a,b)},MazeGame.prototype.moveBallDown=function(){var a=this.ball.i+2,b=this.ball.j,c=this.ball.i+1,d=this.ball.j;this.grid[c][d].hasClass("inactive")&&this.moveBall(a,b)},MazeGame.prototype.moveBallRight=function(){var a=this.ball.i,b=this.ball.j+2,c=this.ball.i,d=this.ball.j+1;this.grid[c][d].hasClass("inactive")&&this.moveBall(a,b)},MazeGame.prototype.moveBall=function(a,b){void 0!==this.grid[a]&&void 0!==this.grid[a][b]&&(this.grid[a][b].append(this.ball.object),this.ball.i=a,this.ball.j=b,this.generator||this.moves++)},MazeGame.prototype.adjacentNodeOpenCheck=function(a,b){var c=this.grid;return!(void 0===c[a.i]||void 0===c[a.i][a.j]||!c[a.i][a.j].hasClass("inactive")||void 0===c[b.i]||void 0===c[b.i][b.j])},MazeGame.prototype.adjacentNodes=function(a){var b=this.grid,c=new Array;return void 0!==b[a.i]&&void 0!==b[a.i][a.j]&&(this.adjacentNodeOpenCheck({i:a.i-1,j:a.j},{i:a.i-2,j:a.j})&&c.push({i:a.i-2,j:a.j}),this.adjacentNodeOpenCheck({i:a.i+1,j:a.j},{i:a.i+2,j:a.j})&&c.push({i:a.i+2,j:a.j}),this.adjacentNodeOpenCheck({i:a.i,j:a.j+1},{i:a.i,j:a.j+2})&&c.push({i:a.i,j:a.j+2}),this.adjacentNodeOpenCheck({i:a.i,j:a.j-1},{i:a.i,j:a.j-2})&&c.push({i:a.i,j:a.j-2})),c},MazeGame.prototype.pathFind=function(a,b){this.clearGraphData();var c=new Array;a.d=0,c.push(a);for(var d=this,e=0;c.length>0;){e++;var f=c.shift(),g=d.getNode(f);if(null==g.data("graphdepth")||void 0===g.data("graphdepth")){g.data("graphdepth",f.d);for(var h=d.adjacentNodes(f),i=0;i<h.length;i++){var j=h[i],k=d.getNode(j);null!=k.data("graphdepth")&&void 0!==g.data("graphdepth")||(j.d=f.d+1,c.push(j),k.data("graphparent",f))}}}var l=this.getNode(b);if(null==l.data("graphdepth")||void 0===l.data("graphdepth"))return d.paintPath(!1),d.hasPath=!1,d.minmoves=-1,!1;for(var m=new Array,f=b;;){m.push(f);var l=this.getNode(f);if(void 0===l.data("graphparent")||null==l.data("graphparent"))break;var f=l.data("graphparent")}return d.hasPath=!0,d.minmoves=m.length-1,d.paintPath(m),m},MazeGame.prototype.paintPath=function(a){if($("td").removeClass("green"),!1!==a)for(var b=0;b<a.length;b++){var c=this.getNode(a[b]);c.addClass("green")}},MazeGame.prototype.clearGraphData=function(){for(var a=this.grid,b=1;b<a.length;b+=2)for(var c=1;c<a[b].length;c+=2)a[b][c].data("graphdepth",null)},MazeGame.prototype.getNode=function(a){return this.grid[a.i][a.j]},MazeGame.prototype.nodeToString=function(a){return(a.i<10?"0"+a.i:""+a.i)+(a.j<10?"0"+a.j:""+a.j)};var string="202001013939i0102010401060108011001140116011801200126012801300132013601380203020702130217022102230225022902330239030203040308031003120320032603340336040904110415041704190423042904310439050205040506051005140520052205240526052805300534053605380601060506130615061706250633063907020708071007180720072207240730073207340736080508090813081708190827082908390902090409060908091009120914091609220924093009340936100110071009101310171019102110271029103110331039110411161122112411261138120112031205120712091211121312151219122112291231123312351237130213061318132413261328140114031409141114131415142114231429143514371504150815101516152015241526153215341536153816011603160516131617162116231627163117041706170817101712171417181720172617281730173217341738180118051809181518231829183318351837190219081910191219161918192019241926192819301936200520112013202120292031203320352039210221042106210821122116211821242128213022052209222322252233223522372239230223082310231223142316231823202326232823322334240124032405240724092419242124232425242924312433243724392502250425082514251625202534253625382601260526092611261726212625262726292631263726392702270627082712271427162718272027242732273427382805280728152817282328252827283328352902290429062908291029122914292029222924292829302936293830073009301130173019302930313033310231043112311431163122312431263128313431363138320132033205320732093219322332313233323933023304330633123316331833203326332833303332333634093411341334193423342534273435350435063508351435163518352235263530353235343536353836013603360536073611361936213623362936373639370237083710371237143716372437263728373037323734373838053807381538193821382938353902390439103912391839203922392439263930393239363938";$(function(){var a=new MazeGame("#game table tbody");getQueryVariable("d")?a.loadGridInfoFromURL():a.loadGridInfoFromString(string),a.generator=!0,a.start(),getQueryVariable("d")?a.loadFromURL():a.loadFromString(string),a.onChange=function(a){$("input.url").val(a.generateURL()),$("div.grid").html(a.gridsize.v+"x"+a.gridsize.h),$("span.moves").html(a.minmoves),a.hasPath?$(".info-cell.minmoves").removeClass("inactive"):$(".info-cell.minmoves").addClass("inactive")},$("input.url").val(a.generateURL());var b=a.pathFind(a.startingPosition,a.endingPosition);a.hasPath?(a.paintPath(b),$("span.moves").html(b.length),$(".info-cell.minmoves").removeClass("inactive")):$(".info-cell.minmoves").addClass("inactive"),a.startInput()});